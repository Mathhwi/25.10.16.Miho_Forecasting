# 강우 패턴 상관분석 방법론 상세 문서

**작성일**: 2025-10-13  
**분석 대상**: 무심천 유역 홍수 사건 (2014-2023)

---

## 1. 개요

본 연구에서는 **청주 금천 관측소**와 **청주 가덕 관측소**의 시간별 강수량 데이터 간의 관계를 정량적으로 분석하기 위해 두 가지 상관분석 방법을 사용하였다.

---

## 2. 분석 대상 변수

### 2.1 입력 변수
- **변수 1**: 청주 금천 관측소 시간별 강수량 (mm/hr)
- **변수 2**: 청주 가덕 관측소 시간별 강수량 (mm/hr)
- **시간 해상도**: 1시간
- **분석 기간**: 각 홍수 사건별로 교차 시점 24시간 전부터 피크 시점 24시간 후까지

### 2.2 출력 지표
1. **동시 상관계수 (Synchronous Correlation Coefficient)**
2. **최대 교차상관계수 (Maximum Cross-Correlation Coefficient)**
3. **최적 시간지연 (Optimal Time Lag)**

---

## 3. 분석 방법론

### 3.1 피어슨 상관계수 (동시 상관계수)

#### 정의
두 관측소의 **같은 시간대** 강수량 간의 선형 관계를 측정

#### 수식
```
         Σ[(Xi - X̄)(Yi - Ȳ)]
r = ─────────────────────────────
    √[Σ(Xi - X̄)²] × √[Σ(Yi - Ȳ)²]
```

where:
- Xi: 시각 i에서 금천 관측소 강수량
- Yi: 시각 i에서 가덕 관측소 강수량
- **X̄**: **해당 사건 구간**의 금천 평균 강수량 ⭐
- **Ȳ**: **해당 사건 구간**의 가덕 평균 강수량 ⭐
- n: 전체 시간 스텝 수

#### 계산 구간
- **각 사건별로 독립적으로 계산**:
  - 시작: 2.34m 교차 시간 **24시간 전**
  - 종료: 피크 시간 **24시간 후**
  - **총 길이**: 48시간 + (교차~피크 시간차) = **사건마다 다름**
  - 예시: 사건 #3은 51시간, 사건 #4는 53시간 등
- 결측값 제외

💡 **중요**: X̄, Ȳ는 **전체 10년 데이터의 평균이 아닌**, 
각 사건의 **분석 구간 전체**의 평균값입니다. 
구간 길이는 사건마다 다르며(약 50~60시간), 
이를 통해 사건별 강수 **패턴의 유사성**을 측정합니다.

#### 해석
- **r ≥ 0.7**: 강한 양의 상관관계 → **동시강우 패턴**
- **0.3 ≤ r < 0.7**: 중간 정도 상관관계
- **r < 0.3**: 약한 상관관계

#### 이론적 근거
- Cohen (1988): r ≥ 0.7을 강한 효과 크기(effect size)로 정의
- 심리학 및 사회과학에서 널리 사용되는 기준을 기상학 분야에 적용

---

### 3.2 교차상관분석 (Cross-Correlation Analysis)

#### 정의
시간 지연(time lag)을 고려하여 두 시계열 간의 최대 상관관계를 찾는 방법

#### 수식
```
            Σ[(Xi - X̄)(Yi+τ - Ȳ)]
ρ(τ) = ─────────────────────────────
       √[Σ(Xi - X̄)²] × √[Σ(Yi - Ȳ)²]
```

where:
- τ (tau): 시간 지연 (time lag, 단위: 시간)
- Xi: 시각 i에서 금천 관측소 강수량
- Yi+τ: 시각 i+τ에서 가덕 관측소 강수량
- ρ(τ): 시간 지연 τ에 대한 교차상관계수

#### 계산 과정
1. **지연 범위 설정**: τ ∈ [-12, +12] 시간
   - 음수 지연: 가덕이 금천보다 먼저 강우
   - 양수 지연: 금천이 가덕보다 먼저 강우

2. **교차상관계수 계산**: 각 지연값 τ에 대해 ρ(τ) 계산

3. **최대값 탐색**:
   ```
   최대_교차상관 = max{|ρ(τ)|, τ ∈ [-12, +12]}
   최적_시간지연 = argmax{|ρ(τ)|, τ ∈ [-12, +12]}
   ```

#### 해석
- **최대_교차상관 ≥ 0.7** AND **|최적_시간지연| ≥ 2시간**: **지연강우 패턴**
- 최적_시간지연 > 0: 금천이 가덕보다 먼저 강우 시작
- 최적_시간지연 < 0: 가덕이 금천보다 먼저 강우 시작

#### 물리적 의미
- 시간 지연은 강우 시스템의 공간적 이동을 반영
- 두 관측소 간 거리와 기상 시스템 이동 속도에 따라 결정

---

### 3.3 강수량 비율 (Rainfall Ratio)

#### 정의
두 관측소 간 총 강수량의 비율

#### 수식
```
         Σ(금천_강수량i)
비율 = ───────────────────
         Σ(가덕_강수량i)
```

#### 해석
- **비율 ≥ 2.0**: 금천 집중형 강우 → **집중강우 패턴 (금천)**
- **비율 ≤ 0.5**: 가덕 집중형 강우 → **집중강우 패턴 (가덕)**
- **0.5 < 비율 < 2.0**: 균형적 강우 분포

#### 이론적 근거
- 2배 이상 차이는 국지적 강우 특성을 나타냄
- 공간적으로 불균일한 강수 분포의 지표

---

## 4. 패턴 분류 의사결정 트리

```
시작
  │
  ├─> 동시_상관계수 ≥ 0.7?
  │    YES → [동시강우 패턴]
  │    NO  ↓
  │
  ├─> 강수량_비율 ≥ 2.0?
  │    YES → [집중강우 패턴 - 금천집중]
  │    NO  ↓
  │
  ├─> 강수량_비율 ≤ 0.5?
  │    YES → [집중강우 패턴 - 가덕집중]
  │    NO  ↓
  │
  ├─> (동시_상관 < 0.7) AND (교차상관 ≥ 0.7) AND (|시간지연| ≥ 2)?
  │    YES → [지연강우 패턴]
  │    NO  ↓
  │
  └─> [비정형 패턴]
```

---

## 5. 계산 구현 세부사항

### 5.1 Python 구현 코드 (핵심 부분)

```python
import numpy as np
from scipy import stats

# 1. 피어슨 상관계수 계산
def calculate_pearson_correlation(x, y):
    """
    x: 금천 강수량 시계열
    y: 가덕 강수량 시계열
    """
    # 유효한 데이터만 사용 (NaN 제외)
    mask = ~(np.isnan(x) | np.isnan(y))
    x_valid = x[mask]
    y_valid = y[mask]
    
    # 표준편차가 0이면 상관계수 계산 불가
    if x_valid.std() == 0 or y_valid.std() == 0:
        return 0.0
    
    # 피어슨 상관계수
    correlation, _ = stats.pearsonr(x_valid, y_valid)
    return correlation

# 2. 교차상관 계산
def calculate_cross_correlation(x, y, max_lag=12):
    """
    x: 금천 강수량 시계열
    y: 가덕 강수량 시계열
    max_lag: 최대 지연 시간 (시간)
    """
    correlations = []
    lags = range(-max_lag, max_lag + 1)
    
    for lag in lags:
        if lag < 0:
            # 가덕이 먼저 시작
            x_shifted = x[:lag]
            y_shifted = y[-lag:]
        elif lag > 0:
            # 금천이 먼저 시작
            x_shifted = x[lag:]
            y_shifted = y[:-lag]
        else:
            # 지연 없음
            x_shifted = x
            y_shifted = y
        
        if len(x_shifted) > 1:
            corr = calculate_pearson_correlation(x_shifted, y_shifted)
        else:
            corr = 0.0
        
        correlations.append(corr)
    
    # 최대 교차상관과 최적 지연 찾기
    max_idx = np.argmax(np.abs(correlations))
    max_cross_corr = correlations[max_idx]
    optimal_lag = list(lags)[max_idx]
    
    return max_cross_corr, optimal_lag

# 3. 강수량 비율 계산
def calculate_rainfall_ratio(geumcheon_rainfall, gadeok_rainfall):
    """
    geumcheon_rainfall: 금천 총 강수량
    gadeok_rainfall: 가덕 총 강수량
    """
    if gadeok_rainfall == 0:
        return float('inf')
    
    return geumcheon_rainfall / gadeok_rainfall
```

---

## 6. 검증 및 품질 관리

### 6.1 데이터 품질 확인
- 결측값 처리: NaN 및 음수 강수량 제외
- 이상치 탐지: 물리적으로 불가능한 값 (예: 200mm/hr 이상) 확인
- 시계열 연속성: 시간 간격 균일성 확인

### 6.2 통계적 유의성
- 모든 상관계수는 p-value < 0.05 기준으로 통계적 유의성 확인
- 샘플 크기: 각 사건당 최소 24개 시간 스텝 (24시간)

### 6.3 민감도 분석
- 지연 범위 변경 (±6h, ±12h, ±24h) 시 결과 안정성 확인
- 상관계수 기준값 (0.6, 0.7, 0.8) 변경 시 분류 변화 분석

---

## 7. 결과 해석 가이드

### 7.1 동시강우 패턴 (r ≥ 0.7)
**물리적 의미**: 
- 광역 강우 시스템이 두 관측소를 동시에 영향
- 전선형 강우 또는 광역 저기압

**예시**: 사건 #1 (r = 0.721)
- 금천과 가덕에서 거의 동시에 유사한 강도로 강우 발생

### 7.2 집중강우 패턴 (비율 ≥ 2.0 or ≤ 0.5)
**물리적 의미**:
- 국지성 호우 또는 소규모 대류 시스템
- 공간적으로 제한된 강우 현상

**예시**: 사건 #4 (비율 = 4.61, 금천집중)
- 금천: 274mm, 가덕: 60mm
- 금천 지역에 집중된 국지성 호우

### 7.3 지연강우 패턴 (교차상관 ≥ 0.7, |지연| ≥ 2h)
**물리적 의미**:
- 강우 시스템의 공간적 이동
- 이동성 저기압이나 전선의 통과

**예시**: 사건 #12 (지연 = 2시간)
- 한 관측소에서 강우 시작 후 2시간 뒤 다른 관측소에서 유사 패턴

### 7.4 비정형 패턴 (위 조건 모두 미충족)
**물리적 의미**:
- 복잡한 기상 상황
- 여러 강우 시스템의 복합 작용
- 국지적 지형 효과

---

## 8. 제한사항 및 향후 연구

### 8.1 현재 분석의 제한사항
1. 관측소 개수: 2개 (공간 해상도 제한)
2. 시간 해상도: 1시간 (분 단위 변화 포착 불가)
3. 선형 관계 가정: 비선형 상관관계 미고려

### 8.2 향후 개선 방향
1. 추가 관측소 데이터 통합
2. 웨이블릿 분석 등 고급 시계열 분석 기법 적용
3. 기상 레이더 데이터와의 통합 분석
4. 기계학습 기반 패턴 분류 모델 개발

---

## 9. 참고문헌

1. **Cohen, J. (1988)**. Statistical Power Analysis for the Behavioral Sciences (2nd ed.). Lawrence Erlbaum Associates.
   - 상관계수 효과 크기 기준 제시

2. **Box, G.E.P., Jenkins, G.M., & Reinsel, G.C. (2015)**. Time Series Analysis: Forecasting and Control (5th ed.). Wiley.
   - 교차상관분석 방법론

3. **Wilks, D.S. (2011)**. Statistical Methods in the Atmospheric Sciences (3rd ed.). Academic Press.
   - 기상학적 시계열 분석

4. **국토교통부 (2019)**. 하천설계기준·해설. 
   - 한국 하천 홍수 분석 기준

---

## 10. 재현성 보장

### 10.1 사용 소프트웨어
- Python 3.13.3
- pandas 2.2.x
- numpy 1.26.x
- scipy 1.11.x

### 10.2 난수 시드
- K-Means 클러스터링: random_state=42

### 10.3 데이터 접근
- 원본 데이터: `무심천_통합데이터_2014_2023_완전판.csv`
- 분석 코드: `분석코드_comprehensive_data_integration_and_analysis.py`

---

**문서 종료**

