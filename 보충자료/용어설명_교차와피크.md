# 용어 설명: 교차(Crossing)와 피크(Peak)

## 질문
> "교차"가 뭐야? 2.34m 도달 시간?  
> "피크"는 뭐야?

---

## ✅ 답변

### 1️⃣ 교차 (Crossing Time)

**정의**: 수위가 2.34m를 **"상승하면서 넘는"** 시점

#### 코드 (247-251번 라인)
```python
# 이전 시점이 threshold 미만, 현재 시점이 threshold 이상인 경우
df['이전수위'] = df['수위'].shift(1)
df['상승교차'] = (df['이전수위'] < threshold) & (df['수위'] >= threshold)

crossing_indices = df[df['상승교차']].index.tolist()
```

#### 조건
- **이전 시간**: 수위 < 2.34m
- **현재 시간**: 수위 ≥ 2.34m
- **방향**: 상승 중 (↗)

#### 영어 표현
**"Crossing from below"** (하향 → 상향 교차)

---

### 2️⃣ 피크 (Peak Time)

**정의**: 교차 시점부터 **24시간 내** 최대 수위 시점

#### 코드 (258-271번 라인)
```python
# 피크 찾기: 교차 시점부터 다음 24시간 내 최대 수위
peak_end_time = crossing_time + timedelta(hours=24)
peak_window = df[(df['일시'] >= crossing_time) & (df['일시'] <= peak_end_time)]

max_level = peak_window['수위'].max()
peak_time = peak_window[peak_window['수위'] == max_level]['일시'].iloc[0]
```

#### 조건
- **탐색 범위**: 교차 시간 ~ 교차 + 24시간
- **정의**: 이 범위 내 **최대 수위 시점**
- **추가 조건**: 피크 수위 ≥ 2.34 + 0.1m (우발적 변동 제외)

---

## 📊 시각적 설명

```
수위(m)
  3.0 ┤           ╭─── 피크 (Peak) ⭐
      │          ╱ 
  2.8 ┤         ╱
      │        ╱
  2.6 ┤       ╱
      │      ╱
  2.4 ┤    ╱◄─── 교차 (Crossing) ⭐ [수위가 2.34m 상승하면서 통과]
  2.3 ┤   ╱
  2.2 ┤  ╱
  2.0 ┤─╯
      │
      └────┬───────┬───────────────► 시간
         교차    교차+3h
        (t=0)   (피크 예시)
        
        |◄─── 24시간 탐색 범위 ───►|
```

---

## 🔍 구체적 예시

### 사건 #3 (2017-07-09)

**시간별 수위 변화**:

| 시간 | 수위(m) | 설명 |
|------|---------|------|
| 07-09 14:00 | 2.28 | 2.34 미만 |
| 07-09 **15:00** | **2.35** | **교차 시점** ⭐ (2.28→2.35, 상승하면서 2.34 통과) |
| 07-09 16:00 | 2.51 | 계속 상승 |
| 07-09 17:00 | 2.68 | 계속 상승 |
| 07-09 **18:00** | **2.82** | **피크 시점** ⭐ (24시간 내 최대값) |
| 07-09 19:00 | 2.75 | 하강 시작 |
| 07-09 20:00 | 2.65 | 계속 하강 |

**결과**:
- **교차 시간**: 2017-07-09 15:00
- **피크 시간**: 2017-07-09 18:00
- **시간차**: 3시간

---

## 🎯 왜 이렇게 정의했나?

### 교차 (Crossing) 정의 이유

#### 1. 물리적 의미
- **홍수 위험**은 수위가 **상승**할 때 발생
- 하강 중 2.34m 통과는 위험 감소 의미
- **상승 교차**만 독립 사건으로 인정

#### 2. 독립 사건 분리
```
수위
  3.0 ┤  ╭─╮     ╭─╮
      │ ╱   ╲   ╱   ╲
  2.4 ┤╱     ╲─╯     ╲
      │ ↑    ↓  ↑    ↓
      └─1────2──3────4─► 시간
      
1: 교차 (상승) → 사건 #1 ✅
2: 통과 (하강) → 카운트 안함 ❌
3: 교차 (상승) → 사건 #2 ✅
4: 통과 (하강) → 카운트 안함 ❌
```

#### 3. 코드 표현
```python
# 상승 교차만 감지
df['상승교차'] = (df['이전수위'] < 2.34) & (df['수위'] >= 2.34)
```

---

### 피크 (Peak) 정의 이유

#### 1. 수문학적 의미
- 수위가 **최고점**에 도달한 시점
- 강우-수위 반응의 **종점**
- 피해 규모와 직결

#### 2. 24시간 제한 이유
```python
peak_end_time = crossing_time + timedelta(hours=24)
```

**이유**:
- 일반적으로 강우 후 24시간 내 피크 도달
- 24시간 이상 지연되면 다른 강우 영향 가능성
- 명확한 사건 분리를 위한 시간 제약

#### 3. 우발적 변동 제외
```python
# 피크가 threshold + 0.1m 이상이어야 함
if max_level < threshold + 0.1:
    continue
```

**이유**:
- 2.34m → 2.36m 정도 상승은 측정 오차 가능
- 최소 2.44m 이상 도달해야 의미 있는 사건

---

## 📐 분석 구간 정의

### 전체 흐름

```
        교차 24h 전       교차         피크        피크 24h 후
            │            │           │             │
            ▼            ▼           ▼             ▼
───────┬────────────┬────────────┬────────────┬─────────► 시간
       │            │            │            │
       │◄─ 24h ─►│◄─ 3h 예시 ─►│◄─ 24h ──►│
       │            │            │            │
       └────────────┴────────────┴────────────┘
              분석 구간 전체 (51시간 예시)
```

### 구간 정의 (273-275번 라인)
```python
# 분석 기간: 교차 24시간 전 ~ 피크 후 24시간
event_start = crossing_time - timedelta(hours=24)
event_end = peak_time + timedelta(hours=24)
```

### 길이 계산
```
총 길이 = (피크 + 24h) - (교차 - 24h)
       = (피크 - 교차) + 48h
       = 교차~피크 시간차 + 48시간
```

**예시**:
- 교차~피크 3시간 → 총 51시간
- 교차~피크 5시간 → 총 53시간
- 교차~피크 10시간 → 총 58시간

---

## 🎓 논문 표현

### 한글
- **교차 시간**: 수위가 기준값(2.34m)을 상승하면서 초과한 시점
- **피크 시간**: 교차 후 24시간 내 최대 수위 도달 시점

### 영문
- **Crossing Time**: The moment when water level rises above the threshold (2.34m) from below
- **Peak Time**: The time of maximum water level within 24 hours after crossing

---

## 📝 요약

| 용어 | 정의 | 조건 |
|------|------|------|
| **교차** | 2.34m **상승 통과** 시점 | 이전 < 2.34 AND 현재 ≥ 2.34 |
| **피크** | 교차 후 24h 내 **최대 수위** 시점 | 교차 ~ 교차+24h 범위의 max |

**분석 구간**: 교차 24h 전 ~ 피크 24h 후 (사건마다 다름)

---

**작성일**: 2025-10-15  
**참고 코드**: `분석코드_comprehensive_data_integration_and_analysis.py` (235-275번 라인)

